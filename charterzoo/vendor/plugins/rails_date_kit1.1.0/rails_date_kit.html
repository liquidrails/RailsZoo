<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.1.0" />
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
}

strong {
  font-weight: bold;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1 {
  border-bottom: 2px solid silver;
}
h2 {
  border-bottom: 2px solid silver;
  padding-top: 0.5em;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revision {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble,
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-right: 10%;
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.5em;
  margin-bottom: 2.5em;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock {
  margin-right: 0%;
}
div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock > div.content {
  padding-left: 2.0em;
}

div.attribution {
  text-align: right;
}
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 2px solid silver;
}

div.exampleblock > div.content {
  border-left: 2px solid silver;
  padding: 0.5em;
}

div.verseblock div.content {
  white-space: pre;
}

div.imageblock div.content { padding-left: 0; }
div.imageblock img { border: 1px solid silver; }
span.image img { border-style: none; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: italic;
}
dd > *:first-child {
  margin-top: 0;
}

ul, ol {
    list-style-position: outside;
}
ol.olist2 {
  list-style-type: lower-alpha;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}

div.hlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
td.hlist1 {
  vertical-align: top;
  font-style: italic;
  padding-right: 0.8em;
}
td.hlist2 {
  vertical-align: top;
}

@media print {
  div#footer-badges { display: none; }
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-content {
  padding-left: 2.0em;
}

div.exampleblock-content {
  border-left: 2px solid silver;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){generateToc(2)}
/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, October 2006. License: GPL */

function getText(el) {
  var text = "";
  for (var i = el.firstChild; i != null; i = i.nextSibling) {
    if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
      text += i.data;
    else if (i.firstChild != null)
      text += getText(i);
  }
  return text;
}

function TocEntry(el, text, toclevel) {
  this.element = el;
  this.text = text;
  this.toclevel = toclevel;
}

function tocEntries(el, toclevels) {
  var result = new Array;
  var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
  // Function that scans the DOM tree for header elements (the DOM2
  // nodeIterator API would be a better technique but not supported by all
  // browsers).
  var iterate = function (el) {
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
        var mo = re.exec(i.tagName)
        if (mo)
          result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
        iterate(i);
      }
    }
  }
  iterate(el);
  return result;
}

// This function does the work. toclevels = 1..4.
function generateToc(toclevels) {
  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementsByTagName("body")[0], toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "toc" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
}
/*]]>*/
</script>
<title>Rails Date Kit</title>
</head>
<body>
<div id="header">
<h1>Rails Date Kit</h1>
<span id="author">Stuart Rackham</span><br />
<span id="email"><tt>&lt;<a href="mailto:srackham@methods.co.nz">srackham@methods.co.nz</a>&gt;</tt></span><br />
<span id="revision">version 1.1.0,</span>
March 2007
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="preamble">
<div class="sectionbody">
<p>When it comes to setting a default date display format for both
display elements and form input elements in Rails it gets quite tricky
(a good explanation can be found on the Rails forum post
<a href="http://www.ruby-forum.com/topic/57923">http://www.ruby-forum.com/topic/57923</a>).</p>
<p>In this article I'll show you how to set a global display format for
all your dates and how to input and validate dates with user friendly
date formats using a <tt>date_field</tt> helper plus a lightweight JavaScript
calendar control.</p>
</div>
</div>
<h2>Download</h2>
<div class="sectionbody">
<p>A tarball containing code for the <a href="date_validator.rb">date
validator</a>, <a href="date_helper.rb">date_field helper</a> and
<a href="calendar.js">calendar control</a> can be download here
<a href="http://www.methods.co.nz/rails_date_kit/rails_date_kit_1.1.0.tar.gz">http://www.methods.co.nz/rails_date_kit/rails_date_kit_1.1.0.tar.gz</a>.</p>
<p>Take a look at the <a href="calendar_example.html">calendar_example.html</a> to see the calendar
control in action.  The calendar look and feel copies the
<a href="http://calendar.swazz.org">Swazz Calendar</a> but the underlying code has
been rewritten (see <a href="calendar.README">calendar.README</a>).</p>
<p>Look at the documentation header in <tt>calendar.js</tt> for the calendar
control options and how it is used.</p>
</div>
<h2>Setting application wide date display format</h2>
<div class="sectionbody">
<p>Add to your preferred date display format into <tt>./config/environment.rb</tt>:</p>
<div class="listingblock">
<div class="content">
<pre><tt>ActiveSupport::CoreExtensions::Date::Conversions::DATE_FORMATS.merge!(
  :default =&gt; '%d %b %Y'
)</tt></pre>
</div></div>
<p>Now this is fine for automatically formatting dates in display
elements but there are a couple of problems:</p>
<ul>
<li>
<p>
Rails uses the <tt>:default</tt> format for writing the database &#8212; so if your
  database does not understand the default format you'll store null
  dates, not so good.
</p>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This is the case in Rails 1.2.1 but seems to have been fixed by
Edge Rails revision 6270, March 2007. See TRAC ticket
<a href="http://dev.rubyonrails.org/ticket/7411">http://dev.rubyonrails.org/ticket/7411</a> (alternatively 1.2.1 users
could patch the <tt>quote</tt> method in
<tt>lib/active_record/connection_adapters/abstract/quoting.rb</tt>).</td>
</tr></table>
</div>
</li>
<li>
<p>
Date values put into text input field helpers are not formatted with
  the <tt>:default</tt> date format, the raw database format is used. To get
  around this restriction I explicitly set the field values when using
  text input elements for dates (see the <tt>date_field</tt> example in the
  next section).
</p>
</li>
</ul>
</div>
<h2>Inputting dates with the <tt>date_field</tt> helper and calendar control</h2>
<div class="sectionbody">
<ul>
<li>
<p>
Put <tt>calendar.js</tt> in <tt>./public/javascripts</tt>.
</p>
</li>
<li>
<p>
Put <tt>calendar.css</tt> in <tt>./public/stylesheets</tt>.
</p>
</li>
<li>
<p>
Put <tt>calendar_prev.png</tt> and <tt>calendar_next.png</tt> in
  <tt>./public/images</tt>.
</p>
</li>
<li>
<p>
Put <tt>date_helper.rb</tt> <tt>in ./app/helpers</tt>.
</p>
</li>
<li>
<p>
In controllers that input dates (or in the application base
  controller <tt>./app/controllers/application.rb</tt>) put:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>helper :date</tt></pre>
</div></div>
</li>
<li>
<p>
Put the following lines in your page headers:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>&lt;%= stylesheet_link_tag 'calendar.css' %&gt;
&lt;%= javascript_include_tag 'calendar' %&gt;</tt></pre>
</div></div>
</li>
<li>
<p>
In templates with forms that input dates use the <tt>date_field</tt>
  helper. For example:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>&lt;%= date_field('person', 'birthday', :value =&gt; @person.birthday) %&gt;</tt></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The date value is passed explicitly to ensure it's formatted
with the <tt>:default</tt> date format (see explanation in previous section).</td>
</tr></table>
</div>
</li>
</ul>
</div>
<h2>Date Validation</h2>
<div class="sectionbody">
<p>We can now view and input date values, all that remains is to validate
them.  The <tt>date_validator.rb</tt> library module  adds a
<tt>validates_dates</tt> date validator to Rails and accepts a range of user
friendly date formats.</p>
<ul>
<li>
<p>
Drop <tt>date_validator.rb</tt> into <tt>./lib</tt>.
</p>
</li>
<li>
<p>
Require the validator in your models and add date validations. For
  example:
</p>
<div class="listingblock">
<div class="content">
<pre><tt>require_dependency 'date_validator'

validates_dates :birthday,
                :from =&gt; '1 Jan 1930',
                :to =&gt; Date.today,
                :allow_nil =&gt; true</tt></pre>
</div></div>
</li>
</ul>
<p>Dates are particularly vexing in a global web environment as there are
many acceptable abbreviated and locale dependent formats. Rather than
try to support multiple locale dependent formats I side-stepped the
issue and choose two unambiguous formats along with abbreviations and
date intervals.</p>
<p>These formats coupled with the calendar control result in painless
date input.</p>
<dl>
<dt>
The <em>d mmmm yyyy</em> format with abbreviations
</dt>
<dd>
<p>
  Where <em>d</em> is the day number; <em>mmmm</em> is the month name; <em>yyyy</em> is the
  year number. This unambiguous format has been combined with a number
  of abbreviations relative to the current date.  Examples: <em>22</em>, <em>22
  feb</em>, <em>22 feb 06</em>, <em>22 february 2006</em>
</p>
</dd>
<dt>
Date intervals
</dt>
<dd>
<p>
  Using the <em>+n[unit]</em> or <em>-n[unit]</em> format you can assign a date by
  adding or subtracting days, weeks, months or years from the current
  date by entering a number prefixed by a plus or minus character and
  followed by an interval unit. Examples: <em>+22</em>, <em>+22 days</em>, <em>+22d</em>,
  <em>-4 weeks</em>, <em>-4w</em>, <em>-4week</em>, <em>+6 months</em>, <em>+6m</em>, <em>+6month</em>, <em>-2 years</em>,
  <em>-2y</em>
</p>
</dd>
<dt>
The ISO date format
</dt>
<dd>
<p>
  The ISO yyyy-mm-dd date format, although verbose, is the only locale
  independent universally accepted standard.  For example
  <em>2001-12-25</em>.
</p>
</dd>
</dl>
</div>
<h2>CHANGELOG</h2>
<div class="sectionbody">
<dl>
<dt>
2007-03-28: 1.1.0 release
</dt>
<dd>
<ul>
<li>
<p>
Added optional next/previous year buttons (thanks to Ian Miller for
  contributing this feature).
</p>
</li>
<li>
<p>
If the last row of the calendar contains no dates it is not shown
  (thanks to Ian Miller for contributing this feature).
</p>
</li>
<li>
<p>
Blank day cells are distinguished from cells with day numbers.
</p>
</li>
<li>
<p>
Weekend days are distinguished from weekdays.
</p>
</li>
<li>
<p>
Day names displayed as 3 letter abbreviations (previously just the
  first letter of the day name was displayed).
</p>
</li>
<li>
<p>
Added tooltip titles to next/previous month/year buttons.
</p>
</li>
<li>
<p>
Documentation errata.
</p>
</li>
</ul>
</dd>
<dt>
2007-03-16: 1.0.2 release
</dt>
<dd>
<ul>
<li>
<p>
Added day_names option.
</p>
</li>
<li>
<p>
The <tt>date_field</tt> helper will now use the <tt>format</tt> option (if
    specified) to display the initial date value (previously used the
    default format). Thanks to Chris Gernon for this patch.
</p>
</li>
</ul>
</dd>
<dt>
2007-03-04: 1.0.1 release
</dt>
<dd>
<ul>
<li>
<p>
Added calendar control month_names option.
</p>
</li>
<li>
<p>
Updated date_field helper to pass locale month names to calendar
    control.
</p>
</li>
</ul>
</dd>
<dt>
2007-03-03: 1.0 release
</dt>
<dd>
<ul>
<li>
<p>
First public release.
</p>
</li>
</ul>
</dd>
</dl>
</div>
<div id="footer">
<div id="footer-text">
Version 1.1.0<br />
Last updated 28-Mar-2007 08:36:53 NZDT
</div>
</div>
</body>
</html>
